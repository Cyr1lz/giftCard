<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Card Balance Checker</title>
    <style>
        /* Your existing CSS unchanged */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÅ Gift Card Balance Checker</h1>
            <p>Enter your gift card code to check its balance</p>
        </div>

        <div class="price-display" id="priceDisplay">
            <div class="price-label">Current Gift Card Price</div>
            <div class="price-amount" id="priceAmount">Loading...</div>
            <div class="price-note">Check your card balance below</div>
        </div>

        <form id="validateForm">
            <div class="form-group">
                <label for="giftCardCode">Gift Card Code</label>
                <input 
                    type="text" 
                    id="giftCardCode" 
                    name="code" 
                    placeholder="Enter your gift card code"
                    maxlength="25"
                    required
                >
                <div class="format-hint">
                    Up to 25 characters (letters and numbers only)
                </div>
            </div>

            <button type="submit" class="validate-btn" id="validateBtn">
                CHECK BALANCE
            </button>
        </form>

        <div id="result" class="result"></div>

        <div class="examples">
            <h4>Example Format:</h4>
            <code>ABC123XYZ4567890</code>
            <code>1A2B3C4D5E6F7G8H</code>
        </div>

        <div class="admin-link">
            <a href="admin.html">üîß Admin Panel</a>
        </div>
    </div>

    <script>
        // API base URL (adjust if deployed, e.g., to https://yourapp.com)
        const API_BASE = window.location.origin.includes('file://') ? 'http://localhost:3000' : '';

        // Currency symbols mapping
        const CURRENCY_SYMBOLS = {
            'USD': '$',
            'EUR': '‚Ç¨',
            'GBP': '¬£',
            'CAD': 'C$',
            'AUD': 'A$',
            'JPY': '¬•'
        };

        // Format price display
        function formatPrice(amount, currency) {
            if (amount === undefined || amount === null || isNaN(amount)) return 'Not set';
            const symbol = CURRENCY_SYMBOLS[currency] || currency;
            return `${symbol}${parseFloat(amount).toFixed(2)}`;
        }

        // Load and display current price
        async function loadCurrentPrice() {
            try {
                const response = await fetch(`${API_BASE}/api/price`);
                const priceData = await response.json();
                const priceDisplay = document.getElementById('priceDisplay');
                const priceAmount = document.getElementById('priceAmount');
                
                if (priceData.amount !== null) {
                    const formattedPrice = formatPrice(priceData.amount, priceData.currency);
                    priceAmount.textContent = formattedPrice;
                    priceDisplay.classList.add('pulse');
                    setTimeout(() => priceDisplay.classList.remove('pulse'), 2000);
                } else {
                    priceAmount.textContent = 'Price not set';
                    priceAmount.style.opacity = '0.6';
                }
            } catch (error) {
                console.error('Error loading price:', error);
                document.getElementById('priceAmount').textContent = 'Error loading price';
            }
        }

        const form = document.getElementById('validateForm');
        const input = document.getElementById('giftCardCode');
        const button = document.getElementById('validateBtn');
        const result = document.getElementById('result');

        // Format input as user types
        input.addEventListener('input', function(e) {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            result.style.display = 'none';
            result.className = 'result';
        });

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const code = input.value.trim();
            
            // Validate format
            if (!code || code.length > 25 || !/^[A-Z0-9]{1,25}$/.test(code)) {
                showResult('error', '‚ùå Invalid Format', 'Please enter up to 25 characters (letters and numbers only).');
                return;
            }

            // Show loading state
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> Checking...';

            try {
                const response = await fetch(`${API_BASE}/api/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });
                const data = await response.json();

                if (response.ok) {
                    const statusMessages = {
                        'accepted': { icon: '‚úÖ', title: 'Card Accepted', message: 'Your gift card is valid and ready to use!' },
                        'declined': { icon: '‚ùå', title: 'Card Declined', message: 'This gift card is not valid or has been declined.' },
                        'pending': { icon: '‚è≥', title: 'Under Review', message: 'Your gift card is being processed. Please check back later.' }
                    };
                    
                    const statusInfo = statusMessages[data.status] || { icon: '‚ö†Ô∏è', title: 'Unknown Status', message: 'Please try again.' };
                    showResult(data.status, statusInfo.title, statusInfo.message, data);
                } else {
                    showResult('error', '‚ùå Error', data.error || 'Validation failed. Please try again.');
                }
            } catch (error) {
                console.error('Validation error:', error);
                showResult('error', '‚ùå Network Error', 'Unable to connect to server. Please check if the server is running.');
            } finally {
                // Reset button
                button.disabled = false;
                button.innerHTML = 'CHECK BALANCE';
            }
        });

        function showResult(type, title, message, cardData = null) {
            const resultHeader = `<div class="result-header">${getStatusIcon(type)} ${title}</div>`;
            const resultMessage = `<div class="result-details">${message}</div>`;
            
            let cardInfo = '';
            if (cardData && cardData.price && cardData.price.amount !== null) {
                const formattedPrice = formatPrice(cardData.price.amount, cardData.price.currency);
                cardInfo = `
                    <div class="card-info">
                        <div>Card Value</div>
                        <div class="card-price">${formattedPrice}</div>
                        ${cardData.price.individual ? '<small>Individual card pricing</small>' : '<small>Standard pricing</small>'}
                    </div>
                `;
            }
            
            result.className = `result ${type}`;
            result.innerHTML = resultHeader + resultMessage + cardInfo;
            result.style.display = 'block';
        }

        function getStatusIcon(status) {
            const icons = {
                'accepted': '‚úÖ',
                'declined': '‚ùå',
                'pending': '‚è≥',
                'error': '‚ö†Ô∏è'
            };
            return icons[status] || '‚ö†Ô∏è';
        }

        // Listen for price changes (poll every 30s)
        setInterval(loadCurrentPrice, 30000);

        // Initialize the app
        document.addEventListener('DOMContentLoaded', loadCurrentPrice);
    </script>
</body>
</html>